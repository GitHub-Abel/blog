/*
 * Basic Share
 * @version 0.2
 * @author www.qinco.net
 * @license The MIT License (MIT)
 */

// Create closure.

;
(function ($, window, document) {

    //Attach this new method to jQuery
    $.fn.extend({

        //This is where you write your plugin's name
        basicShare: function () {

            var window_width = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
            var window_height = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;

            var is_mobile = false;
            var cellWidth = '50%';
            var cellBoxWidth = '400px';

            if (window_width < 500) {
                cellWidth = '100%';
                is_mobile = true;
                cellBoxWidth = '260px';
            }

            var imgPath = "https://dn-qinco.qbox.me/basicShare/img",
                cssTransition = "-ms-transition-duration: .5s;-moz-transition-duration: .5s;-webkit-transition-duration: .5s;transition-duration: .5s;-ms-transition-property: all;-moz-transition-property: all;-webkit-transition-property: all;transition-property: all;",
                cssOpacity = "-moz-opacity:0.76;-webkit-opacity:0.76;filter:alpha(opacity=76);opacity:0.76;",
                imgPreload = [imgPath + "/weibo-dark.png", imgPath + "/weixin-dark.png"];

            var temp = new Array();
            for (i = 0; i < imgPreload.length; i++) {
                temp[i] = new Image();
                temp[i].src = imgPreload[i];
            }

            $('body').on('click', '.basicShareCloseBtn', function () {
                $('#basicShare_bg').fadeOut('400').remove();
            });

            $('body').on('click', '#basicShareWeixin', function () {

                $('#basicShareBackMenu').fadeIn().css({
                    'display': 'block'
                });

                $('#basicShareOptionBox').hide().html($('#basicShareWeixinShow').html()).fadeIn('1000');
            });

            $('body').on('click', '#basicShareBackMenu', function () {
                $(this).fadeOut();
                $('#basicShareOptionBox').html($('#basicShareTemp').html());
            });

            $('body').on('mouseenter', '.basicShareElement', function () {
                $(this).children('div').css({
                    'background': '#fff',
                    'borderColor': '#f6f6f6',
                    '-webkit-transform': 'scale(1.05)',
                    '-moz-transform': 'scale(1.05)',
                    'transform': 'scale(1.05)',

                    '-moz-opacity': '1',
                    '-webkit-opacity': '1',
                    'opacity': '1',
                    'filter': 'alpha(opacity=100)'
                });
                var $temp = $(this).children('div').children('p');
                $temp.css({
                    'color': $temp.attr('data-color')
                });
            });

            $('body').on('mouseleave', '.basicShareElement', function () {
                $(this).children('div').css({
                    'background': '#f6f6f6',
                    'borderColor': '#fff',
                    '-webkit-transform': 'scale(1)',
                    '-moz-transform': 'scale(1)',
                    'transform': 'scale(1)',

                    '-moz-opacity': '0.76',
                    '-webkit-opacity': '0.76',
                    'opacity': '0.76',
                    'filter': 'alpha(opacity=76)'
                });
                $(this).children('div').children('p').css({
                    'color': '#999'
                });
            });

            return this.each(function () {

                //Assign current element to variable, in this case is UL element
                var _ = $(this);

                var shareUrl = _.attr('data-shareUrl');
                var shareTitle = _.attr('data-shareTitle');
                var sharePic = _.attr('data-sharePic');

                _.on('click', function () {

                    //使用angular/vue等框架时，这三段移到点击事件内
                    if (typeof shareUrl == 'undefined') shareUrl = window.location.href;
                    if (typeof shareTitle == 'undefined') shareTitle = document.title;
                    if (typeof sharePic == 'undefined') sharePic = '';

                    if ($('#basicShare_bg').length > 0) {
                        $('#basicShare_bg').remove();
                    }

                    $('body').append("<div id='basicShare_bg' style='box-sizing:border-box;position: fixed;left:0;top:0;" +
                        "bottom:0;right:0;z-index:9999999999;background:rgba(0,0,0,0.7)'>" + "<div id='basicShare_wrap' " +
                        "style='box-sizing:border-box;display:table;position:relative;margin-left:auto;margin-right:" +
                        "auto;background:#ffffff;overflow:auto;border:4px solid #333;'>" + "<div id='basicShare_close' " +
                        "style='box-sizing:border-box;position:absolute; width:50px;height:50px;right:5px;top:5px;'>" +
                        "<a href='javascript:' class='basicShareCloseBtn' style='box-sizing:border-box;width:50px;height:50px;padding:0;text-align:center;display:block'><img src='" + imgPath + "/closeBtn.png' style='width:32px;height:32px; margin-top:9px;' /></a>" + "</div>" + "<div id='basicShare_back' style='box-sizing:border-box;position:absolute;width:50px;height:50px;left:5px;top:5px;'>" + "<a href='javascript:' id='basicShareBackMenu' style='width:50px;height:50px;padding:0;text-align:center;background:#f6f6f6;display:none;'><img src='" + imgPath + "/backBtn.png' style='width:32px;height:32px; margin-top:9px;' /></a>" + "</div>" + "<div id='basicShare_html' style='box-sizing:border-box;display:table;width:100%; padding:60px 0;'>" + "<div style='box-sizing:border-box;display:table-cell;height:100%; width:100%;min-height:100%; background:#ffffff;' >" + "<div style='box-sizing:border-box;max-width:" + cellBoxWidth + ";margin:auto;height:100%;'>" + "<div style='box-sizing:border-box;display:table;width:100%; height:100%;' >" + "<div id='basicShareOptionBox' style='box-sizing:border-box;display:table-cell;vertical-align:middle;height:100%;'>" + "<div style='box-sizing:border-box; float:left;width:100%;'>" + "<div style='float: left;box-sizing: border-box; width:" + cellWidth + "; text-align:center;'>" + "<a target='_blank' style='display:block;' class='basicShareCloseBtn basicShareElement' href='http://v.t.sina.com.cn/share/share.php?title="
                        + encodeURIComponent(shareTitle) + "&url=" + encodeURIComponent(shareUrl) + "&pic=" + encodeURIComponent(sharePic) + "'>" + "<div style='display:table;box-sizing:border-box;width:100%;background:#f6f6f6;border:1px solid #fff;padding:30px 10px 20px 10px;" + cssTransition + cssOpacity + "'>" + "<div style='display:table;width:100%;'>" + "<img src='" + imgPath + "/weibo-dark.png' alt='Weibo' style=' width:100%;max-width:100px;height: auto;' />" + "</div>" + "<p style='color:#999;" + cssTransition + "' data-color='#e1b064'>分享到微博</p>" + "</div>" + "</a>" + "</div>" + "<div style='float: left;box-sizing: border-box; width:" + cellWidth + ";  text-align:center;'>" + "<a  href='javascript:' style='display:block;' id='basicShareWeixin' class='basicShareElement'>" + "<div style='display:table;box-sizing:border-box;width:100%;background:#f6f6f6;border:1px solid #fff;padding:30px 10px 20px 10px;" + cssTransition + cssOpacity + "'>" + "<div style='display:table;width:100%;'>" + "<img src='" + imgPath + "/weixin-dark.png' alt='Weixin' style='width:100%;max-width:100px;height: auto;' />" + "</div>" + "<p style='color:#999;" + cssTransition + "' data-color='#a0d191'>分享到朋友圈</p>" + "</div>" + "</a>" + "</div>" + "</div>" + "</div>" + "</div>" + "</div>" + "</div>" + "<div style='display:none;' id='basicShareTemp'></div>" + "<div style='display:none;' id='basicShareWeixinShow'>" + "<div style='display:table;width:100%;'>" + "<div style='float:left;width:100%;'>" + "<div style='margin:auto;width:60%;text-align:center;min-height:200px;'>"
                        + "<img alt='二维码加载中...' src='https://cloud.qinco.me/api/qr?size=400&content="
                        + encodeURIComponent(shareUrl) + "' style='width:100%;max-width:300px;height: auto;' />" + "</div>" + "<div style='display:table;width:100%;text-align:center;'>" + "打开微信“扫一扫”，扫描上面的二维码，打开网页后再点击微信右上角的菜单、即可分享到朋友圈" + "</div>" + "</div>" + "</div>" + "</div>" + "</div>" + "</div>" + "</div>");

                    $('#basicShare_bg').css({
                        height: $('body').height() + 'px',
                        filter: "progid:DXImageTransform.Microsoft.gradient( startColorstr='#d1000000', endColorstr='#cf000000',GradientType=0 )"
                    });

                    $('#basicShare_wrap').css({
                        height: 'auto',
                        maxHeight: is_mobile ? parseInt(window_height * 0.9) + 'px' : parseInt(window_height * 0.4) + 'px',
                        minHeight: '200px',

                        width: is_mobile ? '90%' : '70%',
                        minWidth: '300px',
                        maxWidth: is_mobile ? parseInt(window_width * 0.9) + 'px' : '600px'
                    });

                    $('#basicShare_html').children().height($('#basicShare_html').height() + 'px');
                    $('#basicShare_wrap').animate({
                        marginTop: parseInt((window_height - $('#basicShare_wrap').height()) / 2.4) + 'px'
                    }, 100);
                    $('#basicShareTemp').html($('#basicShareOptionBox').html());
                });
            });
        }
    });
})(jQuery, window, document);

var shareInit = function () {
    if ($('.basicShareBtn').length > 0) $('.basicShareBtn').basicShare();
}
shareInit();

